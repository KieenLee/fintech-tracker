1. B·∫£ng Users ‚Äì Qu·∫£n l√Ω Ng∆∞·ªùi d√πng & X√°c th·ª±c

B·∫£ng trung t√¢m l∆∞u th√¥ng tin ƒëƒÉng nh·∫≠p, vai tr√≤ v√† b·∫£o m·∫≠t.

CREATE TABLE Users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL, -- L∆∞u m·∫≠t kh·∫©u ƒë√£ bƒÉm
    role ENUM('customer', 'admin') NOT NULL DEFAULT 'customer',
    telegram_user_id VARCHAR(50) NULL UNIQUE, -- Li√™n k·∫øt v·ªõi Telegram
    is_active BOOLEAN DEFAULT TRUE, -- K√≠ch ho·∫°t/V√¥ hi·ªáu h√≥a t√†i kho·∫£n
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);


üìç Gi·∫£i th√≠ch:

role ph√¢n quy·ªÅn (admin / customer).

telegram_user_id ƒë·ªÉ li√™n k·∫øt v·ªõi bot Telegram.

is_active h·ªó tr·ª£ kh√≥a/m·ªü t√†i kho·∫£n nhanh.

2. B·∫£ng UserProfiles ‚Äì Qu·∫£n l√Ω H·ªì s∆° c√° nh√¢n

L∆∞u th√¥ng tin c√° nh√¢n chi ti·∫øt c·ªßa ng∆∞·ªùi d√πng, t√°ch ri√™ng ƒë·ªÉ tr√°nh ph√¨nh to b·∫£ng Users.

CREATE TABLE UserProfiles (
    user_id INT PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    phone VARCHAR(20) UNIQUE,
    date_of_birth DATE,
    address TEXT,
    avatar_url VARCHAR(255),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    settings TEXT NULL,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE
);


üìç Gi·∫£i th√≠ch:

Li√™n k·∫øt 1-1 v·ªõi Users.

ON DELETE CASCADE: n·∫øu User b·ªã x√≥a ‚Üí Profile c≈©ng bi·∫øn m·∫•t.

3. B·∫£ng Accounts ‚Äì Qu·∫£n l√Ω c√°c Ngu·ªìn ti·ªÅn

Ng∆∞·ªùi d√πng c√≥ th·ªÉ t·∫°o nhi·ªÅu t√†i kho·∫£n (v√≠, ng√¢n h√†ng, v√≠ ƒëi·ªán t·ª≠‚Ä¶).

CREATE TABLE Accounts (
    account_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    account_name VARCHAR(100) NOT NULL,
    account_type ENUM('cash', 'bank_account', 'e_wallet', 'credit_card') NOT NULL,
    current_balance DECIMAL(15, 2) NOT NULL DEFAULT 0.00,
    currency_code CHAR(3) DEFAULT 'VND',
    account_color VARCHAR(7),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE
);


üìç Gi·∫£i th√≠ch:

account_type gi·ªõi h·∫°n lo·∫°i t√†i kho·∫£n ƒë·ªÉ d·ªØ li·ªáu ƒë·ªìng nh·∫•t.

currency_code h·ªó tr·ª£ ƒëa ti·ªÅn t·ªá (VND, USD‚Ä¶).

4. B·∫£ng Categories ‚Äì Qu·∫£n l√Ω Danh m·ª•c Thu/Chi

Ng∆∞·ªùi d√πng c√≥ th·ªÉ t·∫°o danh m·ª•c cha-con ƒë·ªÉ qu·∫£n l√Ω chi ti√™u.

CREATE TABLE Categories (
    category_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    parent_category_id INT NULL,
    category_name VARCHAR(100) NOT NULL,
    category_icon VARCHAR(50),
    category_color VARCHAR(7),
    transaction_type ENUM('expense', 'income') NOT NULL,
    is_default BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (parent_category_id) REFERENCES Categories(category_id) ON DELETE SET NULL
);


üìç Gi·∫£i th√≠ch:

parent_category_id ‚Üí h·ªó tr·ª£ danh m·ª•c con (ƒÇn u·ªëng ‚Üí C√† ph√™).

is_default = TRUE ‚Üí danh m·ª•c m·∫∑c ƒë·ªãnh c·ªßa h·ªá th·ªëng (d√πng chung).

5. B·∫£ng Transactions ‚Äì Giao d·ªãch t√†i ch√≠nh

L∆∞u to√†n b·ªô thu/chi/chuy·ªÉn ti·ªÅn.

CREATE TABLE Transactions (
    transaction_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    account_id INT NOT NULL,
    category_id INT NULL,
    amount DECIMAL(15, 2) NOT NULL,
    transaction_type ENUM('expense', 'income', 'transfer') NOT NULL,
    description TEXT,
    transaction_date DATETIME NOT NULL,
    location VARCHAR(255),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    receipt_image_url VARCHAR(255),
    is_recurring BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id),
    FOREIGN KEY (account_id) REFERENCES Accounts(account_id),
    FOREIGN KEY (category_id) REFERENCES Categories(category_id) ON DELETE SET NULL
);


üìç Gi·∫£i th√≠ch:

H·ªó tr·ª£ transfer ƒë·ªÉ ghi nh·∫≠n giao d·ªãch chuy·ªÉn ti·ªÅn.

C√≥ th·ªÉ l∆∞u location, latitude, longitude ‚Üí h·ªó tr·ª£ mobile app.

is_recurring ƒë·ªÉ ƒë√°nh d·∫•u giao d·ªãch ƒë·ªãnh k·ª≥.

6. B·∫£ng Budgets ‚Äì Qu·∫£n l√Ω Ng√¢n s√°ch

Cho ph√©p ƒë·∫∑t h·∫°n m·ª©c chi ti√™u theo danh m·ª•c.

CREATE TABLE Budgets (
    budget_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    category_id INT NOT NULL,
    amount DECIMAL(15, 2) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    is_recurring BOOLEAN DEFAULT FALSE,
    notification_threshold DECIMAL(5, 2) DEFAULT 90.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES Categories(category_id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_category_period (user_id, category_id, start_date, end_date)
);


üìç Gi·∫£i th√≠ch:

notification_threshold: c·∫£nh b√°o khi chi ti√™u ƒë·∫°t % ng√¢n s√°ch.

UNIQUE constraint ngƒÉn vi·ªác tr√πng ng√¢n s√°ch cho c√πng 1 giai ƒëo·∫°n.

7. B·∫£ng Goals ‚Äì M·ª•c ti√™u Ti·∫øt ki·ªám

Qu·∫£n l√Ω m·ª•c ti√™u t√†i ch√≠nh d√†i h·∫°n c·ªßa ng∆∞·ªùi d√πng.

CREATE TABLE Goals (
    goal_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    goal_name VARCHAR(100) NOT NULL,
    target_amount DECIMAL(15, 2) NOT NULL,
    current_amount DECIMAL(15, 2) NOT NULL DEFAULT 0.00,
    target_date DATE NOT NULL,
    description TEXT,
    goal_color VARCHAR(7),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE
);

8. B·∫£ng Notifications ‚Äì Th√¥ng b√°o

G·ª≠i th√¥ng b√°o cho ng∆∞·ªùi d√πng (qua app/telegram).

CREATE TABLE Notifications (
    notification_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    type ENUM('budget_warning', 'goal_progress', 'transaction_alert', 'system') NOT NULL,
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE
);

9. B·∫£ng Logs ‚Äì Nh·∫≠t k√Ω h·ªá th·ªëng

Theo d√µi c√°c ho·∫°t ƒë·ªông quan tr·ªçng ƒë·ªÉ ki·ªÉm tra/b·∫£o m·∫≠t.

CREATE TABLE Logs (
    log_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100) NOT NULL,
    table_name VARCHAR(50),
    record_id VARCHAR(50),
    old_value TEXT,
    new_value TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE SET NULL
);

üîë Gi·∫£i th√≠ch thi·∫øt k·∫ø chung

S·ª≠ d·ª•ng DECIMAL cho ti·ªÅn t·ªá ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh ch√≠nh x√°c tuy·ªát ƒë·ªëi.

R√†ng bu·ªôc FOREIGN KEY gi·ªØ t√≠nh to√†n v·∫πn d·ªØ li·ªáu.

T√°ch ri√™ng UserProfiles ƒë·ªÉ b·∫£ng Users g·ªçn nh·∫π.

C√≥ Logs ƒë·ªÉ ph·ª•c v·ª• ki·ªÉm to√°n & b·∫£o m·∫≠t.

C√≥ Goals v√† Budgets ‚Üí h·ªó tr·ª£ qu·∫£n l√Ω t√†i ch√≠nh c√° nh√¢n to√†n di·ªán.