import{a as G,r as p,u as B,b,j as e,L as U,B as A,S as O,i as P,k as V,l as W,m as f,M as q,C as n,o as c,p as l,N as M,q as o,U as X,O as Y,Q as z,s as j,R as y,V as H,W as w,X as C,Y as g,Z as N,_ as Q,$ as Z,a0 as L,a1 as F,a2 as J,a3 as ee,a4 as se,a5 as E,G as re}from"./index-B7oz-COM.js";const te="http://localhost:5013/api",R=G.create({baseURL:te,headers:{"Content-Type":"application/json"}});R.interceptors.request.use(i=>{const d=localStorage.getItem("token");return d&&(i.headers.Authorization=`Bearer ${d}`),i});const K={async getDashboard(i){const d=i?`?timeRange=${i}`:"";return(await R.get(`/Report/dashboard${d}`)).data},async exportReport(i,d="csv"){const h=new URLSearchParams;return i&&h.append("timeRange",i),h.append("format",d),(await R.get(`/Report/export?${h.toString()}`,{responseType:"blob"})).data}},ie=()=>{const[i,d]=p.useState("monthly"),[h,v]=p.useState(!0),[t,T]=p.useState(null),[S,k]=p.useState(!1),{t:s}=B(),$=localStorage.getItem("userCurrency")||"USD",u=r=>re(r,$);p.useEffect(()=>{_()},[]),p.useEffect(()=>{t&&_()},[i]);const _=async()=>{try{v(!0);const r=await K.getDashboard(i);T(r)}catch(r){console.error("Error loading report data:",r),b.error(s("reports.load_failed"))}finally{v(!1)}},I=async()=>{try{k(!0);const r=await K.exportReport(i,"csv"),a=window.URL.createObjectURL(r),m=document.createElement("a");m.style.display="none",m.href=a,m.download=`reports-${i}-${new Date().getTime()}.csv`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(a),document.body.removeChild(m),b.success(s("reports.export_success"))}catch(r){console.error("Error exporting report:",r),b.error(s("reports.export_failed"))}finally{k(!1)}},x={primary:"hsl(var(--primary))",chart1:"#8884d8",chart2:"#82ca9d",chart3:"#ffc658",chart4:"#ff7300"},D=(t==null?void 0:t.subscriptionData.map((r,a)=>({...r,color:a===0?x.chart1:x.chart2})))||[];return h?e.jsxs("div",{className:"p-6 flex items-center justify-center",children:[e.jsx(U,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:s("reports.loading")})]}):t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:s("reports.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("reports.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(O,{value:i,onValueChange:d,children:[e.jsx(P,{className:"w-32",children:e.jsx(V,{})}),e.jsxs(W,{children:[e.jsx(f,{value:"daily",children:s("reports.time_periods.daily")}),e.jsx(f,{value:"weekly",children:s("reports.time_periods.weekly")}),e.jsx(f,{value:"monthly",children:s("reports.time_periods.monthly")}),e.jsx(f,{value:"yearly",children:s("reports.time_periods.yearly")})]})]}),e.jsxs(A,{variant:"outline",onClick:I,disabled:S,children:[S?e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(q,{className:"h-4 w-4 mr-2"}),s("common.export")]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("reports.metrics.total_revenue")}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u(t.metrics.totalRevenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:t.metrics.revenueGrowth})," ",s("reports.metrics.from_last_period")]})]})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("reports.metrics.total_users")}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.metrics.totalUsers}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:t.metrics.usersGrowth})," ",s("reports.metrics.from_last_period")]})]})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("reports.metrics.premium_users")}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.metrics.premiumUsers}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:t.metrics.premiumGrowth})," ",s("reports.metrics.from_last_period")]})]})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("reports.metrics.avg_session")}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.metrics.avgSessionTime}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:t.metrics.sessionGrowth})," ",s("reports.metrics.from_last_period")]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(l,{children:s("reports.charts.revenue_trend")}),e.jsx(j,{children:s("reports.charts.revenue_trend_desc")})]}),e.jsx(o,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(H,{data:t.revenueData,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"month"}),e.jsx(g,{}),e.jsx(N,{formatter:(r,a)=>[a==="revenue"?u(Number(r)):r,a==="revenue"?s("reports.charts.revenue"):a]}),e.jsx(Q,{type:"monotone",dataKey:"revenue",stroke:x.primary,fill:x.primary,fillOpacity:.6,name:"revenue"})]})})})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(l,{children:s("reports.charts.user_growth")}),e.jsx(j,{children:s("reports.charts.user_growth_desc")})]}),e.jsx(o,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(Z,{data:t.userGrowthData,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"day"}),e.jsx(g,{}),e.jsx(N,{}),e.jsx(L,{dataKey:"newUsers",fill:x.chart1,name:s("reports.charts.new_users")}),e.jsx(L,{dataKey:"activeUsers",fill:x.chart2,name:s("reports.charts.active_users")})]})})})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(l,{children:s("reports.charts.subscription_distribution")}),e.jsx(j,{children:s("reports.charts.subscription_distribution_desc")})]}),e.jsx(o,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(F,{children:[e.jsx(J,{data:D,cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:5,dataKey:"value",nameKey:"name",children:D.map((r,a)=>e.jsx(ee,{fill:r.color},`cell-${a}`))}),e.jsx(N,{formatter:r=>[`${r}`,s("reports.charts.users")]})]})})})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(l,{children:s("reports.charts.revenue_vs_users")}),e.jsx(j,{children:s("reports.charts.revenue_vs_users_desc")})]}),e.jsx(o,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(se,{data:t.revenueData,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"month"}),e.jsx(g,{yAxisId:"left"}),e.jsx(g,{yAxisId:"right",orientation:"right"}),e.jsx(N,{formatter:(r,a)=>[a==="revenue"?u(Number(r)):r,s(a==="revenue"?"reports.charts.revenue":"reports.charts.users")]}),e.jsx(E,{yAxisId:"left",type:"monotone",dataKey:"revenue",stroke:x.primary,strokeWidth:3,name:"revenue"}),e.jsx(E,{yAxisId:"right",type:"monotone",dataKey:"users",stroke:x.chart2,strokeWidth:3,name:"users"})]})})})]})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(l,{children:s("reports.detailed_metrics.title")}),e.jsx(j,{children:s("reports.detailed_metrics.description")})]}),e.jsx(o,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left pb-3",children:s("reports.detailed_metrics.month")}),e.jsx("th",{className:"text-right pb-3",children:s("reports.detailed_metrics.revenue")}),e.jsx("th",{className:"text-right pb-3",children:s("reports.detailed_metrics.new_users")}),e.jsx("th",{className:"text-right pb-3",children:s("reports.detailed_metrics.premium_users")}),e.jsx("th",{className:"text-right pb-3",children:s("reports.detailed_metrics.conversion_rate")}),e.jsx("th",{className:"text-right pb-3",children:s("reports.detailed_metrics.churn_rate")})]})}),e.jsx("tbody",{children:t.detailedMetrics.map((r,a)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-3",children:r.month}),e.jsx("td",{className:"text-right py-3",children:u(r.revenue)}),e.jsx("td",{className:"text-right py-3",children:r.newUsers}),e.jsx("td",{className:"text-right py-3",children:r.premiumUsers}),e.jsx("td",{className:"text-right py-3",children:r.conversionRate}),e.jsx("td",{className:"text-right py-3",children:r.churnRate})]},a))})]})})})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("reports.load_failed")}),e.jsx(A,{onClick:_,children:s("common.try_again")})]})})};export{ie as default};
