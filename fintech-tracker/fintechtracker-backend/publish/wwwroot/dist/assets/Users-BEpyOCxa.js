import{a as X,r as i,u as Y,b as u,j as e,L,D as Z,c as ee,B as v,P as se,d as re,e as te,f as ae,g as ne,h,I as m,S as P,i as z,k as R,l as k,m as _,n as le,C as N,o as b,p as w,q as y,s as ie,t as ce,T as oe,v as de,w as $,x,y as ue,z as j,A as q,E as he,F as me,G as xe}from"./index-B7oz-COM.js";const je="http://localhost:5013/api",p=X.create({baseURL:je,headers:{"Content-Type":"application/json"}});p.interceptors.request.use(t=>{const l=localStorage.getItem("token");return l&&(t.headers.Authorization=`Bearer ${l}`),t});const g={async getUsers(t){const l=new URLSearchParams;t!=null&&t.search&&l.append("search",t.search),t!=null&&t.role&&l.append("role",t.role),t!=null&&t.subscription&&l.append("subscription",t.subscription),t!=null&&t.page&&l.append("page",t.page.toString()),t!=null&&t.pageSize&&l.append("pageSize",t.pageSize.toString());const a=await p.get(`/User?${l.toString()}`);return{users:a.data,totalCount:parseInt(a.headers["x-total-count"]||"0"),page:parseInt(a.headers["x-page"]||"1"),pageSize:parseInt(a.headers["x-page-size"]||"10")}},async getUserStats(){return(await p.get("/User/stats")).data},async getUser(t){return(await p.get(`/User/${t}`)).data},async createUser(t){return(await p.post("/User",t)).data},async updateUser(t,l){await p.put(`/User/${t}`,l)},async deleteUser(t){await p.delete(`/User/${t}`)}},ge=()=>{const[t,l]=i.useState([]),[a,B]=i.useState(null),[G,F]=i.useState(!0),[S,H]=i.useState(""),[O,f]=i.useState(!1),[o,U]=i.useState(null),[n,C]=i.useState({username:"",email:"",role:"customer",firstName:"",lastName:"",phone:"",subscription:"basic",password:""}),[I,E]=i.useState(!1),{t:r}=Y(),V=localStorage.getItem("userCurrency")||"USD",A=s=>xe(s,V);i.useEffect(()=>{D()},[]),i.useEffect(()=>{const s=setTimeout(()=>{T()},300);return()=>clearTimeout(s)},[S]);const D=async()=>{try{F(!0);const[s,c]=await Promise.all([g.getUsers(),g.getUserStats()]);l(s.users),B(c)}catch(s){console.error("Error loading data:",s),u.error("Failed to load users data")}finally{F(!1)}},T=async()=>{try{const s=await g.getUsers({search:S||void 0});l(s.users)}catch(s){console.error("Error loading users:",s),u.error("Failed to load users")}},J=s=>{U(s),C({username:s.username,email:s.email,role:s.role,firstName:s.firstName||"",lastName:s.lastName||"",phone:"",subscription:s.subscription,password:""}),f(!0)},K=()=>{U(null),C({username:"",email:"",role:"customer",firstName:"",lastName:"",phone:"",subscription:"basic",password:""}),f(!0)},M=async s=>{if(window.confirm(`Are you sure you want to delete ${s.username}?`))try{await g.deleteUser(s.userId),u.success("User deleted successfully"),T(),D()}catch(c){console.error("Error deleting user:",c),u.error("Failed to delete user")}},Q=async s=>{s.preventDefault(),E(!0);try{if(o){const c={username:n.username,email:n.email,role:n.role,firstName:n.firstName||void 0,lastName:n.lastName||void 0,phone:n.phone||void 0,subscription:n.subscription,isActive:!0};await g.updateUser(o.userId,c),u.success("User updated successfully")}else{if(!n.password){u.error("Password is required for new users");return}await g.createUser(n),u.success("User created successfully")}f(!1),U(null),T(),D()}catch(c){console.error("Error saving user:",c),u.error(o?"Failed to update user":"Failed to create user")}finally{E(!1)}},d=(s,c)=>{C(W=>({...W,[s]:c}))};return G?e.jsxs("div",{className:"p-6 flex items-center justify-center",children:[e.jsx(L,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:r("common.loading")})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:r("users.title")}),e.jsx("p",{className:"text-muted-foreground",children:r("users.subtitle")})]}),e.jsxs(Z,{open:O,onOpenChange:f,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(v,{onClick:K,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),r("users.add_user")]})}),e.jsx(re,{children:e.jsxs("form",{onSubmit:Q,children:[e.jsxs(te,{children:[e.jsx(ae,{children:r(o?"users.edit_user":"users.add_new_user")}),e.jsx(ne,{children:r(o?"users.edit_user_desc":"users.create_user_desc")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"username",children:r("auth.username")}),e.jsx(m,{id:"username",value:n.username,onChange:s=>d("username",s.target.value),placeholder:r("users.name_placeholder"),required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"email",children:r("auth.email")}),e.jsx(m,{id:"email",type:"email",value:n.email,onChange:s=>d("email",s.target.value),placeholder:r("users.email_placeholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"firstName",children:r("users.first_name")}),e.jsx(m,{id:"firstName",value:n.firstName,onChange:s=>d("firstName",s.target.value),placeholder:"First name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"lastName",children:r("users.last_name")}),e.jsx(m,{id:"lastName",value:n.lastName,onChange:s=>d("lastName",s.target.value),placeholder:"Last name"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"phone",children:r("users.phone")}),e.jsx(m,{id:"phone",type:"tel",value:n.phone,onChange:s=>d("phone",s.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"role",children:r("users.role")}),e.jsxs(P,{value:n.role,onValueChange:s=>d("role",s),children:[e.jsx(z,{children:e.jsx(R,{placeholder:r("users.select_role")})}),e.jsxs(k,{children:[e.jsx(_,{value:"customer",children:r("sidebar.customer")}),e.jsx(_,{value:"admin",children:r("sidebar.administrator")})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"subscription",children:r("users.subscription")}),e.jsxs(P,{value:n.subscription,onValueChange:s=>d("subscription",s),children:[e.jsx(z,{children:e.jsx(R,{placeholder:r("users.select_subscription")})}),e.jsxs(k,{children:[e.jsx(_,{value:"basic",children:r("common.basic")}),e.jsx(_,{value:"premium",children:r("common.premium")})]})]})]}),!o&&e.jsxs("div",{children:[e.jsx(h,{htmlFor:"password",children:r("auth.password")}),e.jsx(m,{id:"password",type:"password",value:n.password,onChange:s=>d("password",s.target.value),placeholder:"Password",required:!o})]})]}),e.jsxs(le,{children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>f(!1),children:r("common.cancel")}),e.jsxs(v,{type:"submit",disabled:I,children:[I&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),r(o?"users.update_user":"users.create_user")]})]})]})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(N,{children:[e.jsx(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:r("dashboard.total_users")})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.totalUsers)??0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:a==null?void 0:a.totalUsersGrowth})," ",r("users.growth_from_last_month")]})]})]}),e.jsxs(N,{children:[e.jsx(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:r("reports.metrics.premium_users")})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.premiumUsers)??0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:a==null?void 0:a.premiumUsersGrowth})," ",r("users.premium_growth_from_last_month")]})]})]}),e.jsxs(N,{children:[e.jsx(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:r("users.revenue")})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:A((a==null?void 0:a.totalRevenue)??0)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:a==null?void 0:a.revenueGrowth})," ",r("users.revenue_growth_from_last_month")]})]})]}),e.jsxs(N,{children:[e.jsx(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(w,{className:"text-sm font-medium",children:r("users.avg_retention")})}),e.jsxs(y,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(a==null?void 0:a.avgRetention)??0,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"text-green-600",children:a==null?void 0:a.retentionGrowth})," ",r("users.retention_growth_from_last_month")]})]})]})]}),e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsx(w,{children:r("sidebar.users")}),e.jsx(ie,{children:r("users.manage_user_base")})]}),e.jsxs(y,{children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ce,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:r("users.search_users"),value:S,onChange:s=>H(s.target.value),className:"pl-8"})]})}),e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs($,{children:[e.jsx(x,{children:r("users.user")}),e.jsx(x,{children:r("users.role")}),e.jsx(x,{children:r("users.subscription")}),e.jsx(x,{children:r("users.join_date")}),e.jsx(x,{children:r("users.last_active")}),e.jsx(x,{children:r("users.total_spent")}),e.jsx(x,{className:"text-right",children:r("common.actions")})]})}),e.jsx(ue,{children:t.map(s=>e.jsxs($,{children:[e.jsxs(j,{children:[e.jsx("div",{className:"font-medium",children:s.firstName||s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():s.username}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx(j,{children:e.jsx(q,{variant:s.role==="admin"?"destructive":"default",children:s.role==="admin"?r("sidebar.administrator"):r("sidebar.customer")})}),e.jsx(j,{children:e.jsx(q,{variant:s.subscription==="premium"?"default":"secondary",children:s.subscription==="premium"?r("common.premium"):r("common.basic")})}),e.jsx(j,{children:new Date(s.joinDate).toLocaleDateString()}),e.jsx(j,{children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"}),e.jsx(j,{children:A(s.totalSpent)}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>J(s),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>M(s),children:e.jsx(me,{className:"h-4 w-4"})})]})})]},s.userId))})]})]})]})]})};export{ge as default};
